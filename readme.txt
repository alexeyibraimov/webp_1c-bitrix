
Привожу пример, реализованный в одном из моих проектов, для генерации на лету файлов Webp 
по указанным уже на станице JPG и PNG, без их замены в коде страниц, так же есть возможность распространить пример и на GIF.
К сожалению, если ваш сайт использует CDN, эти файлы туда не попадут и будут, как и ранее, подгружаться JPG и PNG.

В корень сайта требуется разместить скрипт-генератор: 

/create_webp.php

В конфиге nginx для вашего сайта ищем 

server {...} 

и меняем в нем аналогичной блок

      location ~* ^.+\.(jpg|jpeg|gif|png|svg|js|css|mp3|ogg|mpeg|avi|zip|gz|bz2|rar|swf|ico)$ {...}


В файл .htaccess (в корне сайта), на случай, если идет прямой запрос к еще не существующему файлу (типа "/fullpath/filename.webp"), для апача, нужно прописать редирект на скрипт-генератор:

  RewriteCond %{REQUEST_URI} !(.*)/$
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteRule ^(.*)\.webp$ /create_webp\.php [L]



----------------------------------------------

Ибраимов Алексей,
 
email: alex_lab@inbox.ru